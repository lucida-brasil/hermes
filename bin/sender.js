"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function replaceAll(e,n,t){for(;-1!==e.indexOf(n);)e=e.replace(n,t);return e}function csv2json(e){e=replaceAll(e,"\r","");var n=e.split("\n"),t=[],i=n.shift().split(";");return n.pop(),n.forEach(function(e){e=e.split(";");var n={};i.forEach(function(t,i){n[t]=e[i]}),t.push(n)}),t}function buildAttachment(e,n){e=e?e.split(","):[];var t=new _easyZip2["default"].EasyZip,i=e[0]||!1;if(i){var a;!function(){var l=i[i.length-1],o=Math.round(1e6*Math.random()),s=_path2["default"].join(__dirname,"../tmp/"+o+".zip");"\\"===l||"/"===l?t.zipFolder(i,function(){return t.writeToFile(s,function(){n&&n([s])})}):(a=[],e.forEach(function(e){e=(e||"").trim();var n=e.split("\\"),t=n[n.length-1].split(".")[1];t&&a.push(e)}),n&&n(a))}()}else n&&n(null)}function clear(e){e&&e.forEach(function(e){(e.indexOf("/tmp/")>=0||e.indexOf("\\tmp\\")>=1)&&_fs2["default"].unlink(e,function(e){e&&console.log(e)})})}function sendMailing(e){console.log("Disparando emails de "+e),_fs2["default"].readFile(e,"utf-8",function(e,n){var t=csv2json(n);t.forEach(function(e){e.to=replaceAll(e.to," ","").split(","),buildAttachment(e.attachments,function(n){new _mailClass2["default"](_configJson2["default"].email.user,e.to,e.message,e.subject,n).send(_smtp2["default"],function(e,t){e?console.log(e):console.log("email send at "+t.header.date),clear(n)})})})})}Object.defineProperty(exports,"__esModule",{value:!0});var _fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_easyZip=require("easy-zip"),_easyZip2=_interopRequireDefault(_easyZip),_configJson=require("../config.json"),_configJson2=_interopRequireDefault(_configJson),_mailClass=require("./mail.class"),_mailClass2=_interopRequireDefault(_mailClass),_smtp=require("./smtp"),_smtp2=_interopRequireDefault(_smtp);exports["default"]={mailing:function(e){console.log("\n**HERMES INIT**\n"),e=_path2["default"].resolve(process.cwd(),e),sendMailing(e)},all:function(){console.log("\n**HERMES INIT**\n");var e=_path2["default"].resolve(_configJson2["default"].files.base),n=_fs2["default"].readdirSync(e);n.forEach(function(n){var t=_path2["default"].join(e,""+n);sendMailing(t)})}},module.exports=exports["default"];