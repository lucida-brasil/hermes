"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function replaceAll(e,n,i){for(;-1!==e.indexOf(n);)e=e.replace(n,i);return e}function csv2json(e){e=replaceAll(e,"\r","");var n=e.split("\n"),i=[],a=n.shift().split(";");return n.pop(),n.forEach(function(e){e=e.split(";");var n={};a.forEach(function(i,a){n[i]=e[a]}),i.push(n)}),i}function zipAttachment(e,n){e=e?e.split(","):[];var i=new _easyZip2["default"].EasyZip,a=e[0]||!1;a?!function(){var e=a[a.length-1],t=Math.round(1e6*Math.random()),r=_path2["default"].join(__dirname,"../tmp/"+t+".zip");"\\"===e||"/"===e?i.zipFolder(a,function(){return i.writeToFile(r,function(){n&&n(r)})}):n&&n(a)}():n&&n(null)}function sendMailing(e){console.log("Disparando emails de "+e),_fs2["default"].readFile(e,"utf-8",function(e,n){var i=csv2json(n);i.forEach(function(e){e.to=replaceAll(e.to," ","").split(","),zipAttachment(e.attachments,function(n){var i=n?[n]:void 0;new _mailClass2["default"](_configJson2["default"].email.user,e.to,e.message,e.subject,i).send(_smtp2["default"])})})})}var _fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_easyZip=require("easy-zip"),_easyZip2=_interopRequireDefault(_easyZip),_commander=require("commander"),_commander2=_interopRequireDefault(_commander),_configJson=require("../config.json"),_configJson2=_interopRequireDefault(_configJson),_mailClass=require("./mail.class"),_mailClass2=_interopRequireDefault(_mailClass),_smtp=require("./smtp"),_smtp2=_interopRequireDefault(_smtp),send={mailing:function(e){e=_path2["default"].resolve(process.cwd(),e),sendMailing(e)},all:function(){var e=_path2["default"].resolve(_configJson2["default"].files.base),n=_fs2["default"].readdirSync(e);n.forEach(function(n){var i=_path2["default"].join(e,n+"/mailing.csv");sendMailing(i)})}};console.log("\n**HERMES INIT**\n"),_commander2["default"].version("0.0.1").option("-m, --mailing [file]","run one mailing",send.mailing).option("-a, --all","send all mailings in base folder",send.all).parse(process.argv);