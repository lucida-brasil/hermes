"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function replaceAll(e,i,t){for(;-1!==e.indexOf(i);)e=e.replace(i,t);return e}function csv2json(e){e=replaceAll(e,"\r","");var i=e.split("\n"),t=[],a=i.shift().split(";");return i.pop(),i.forEach(function(e){e=e.split(";");var i={};a.forEach(function(t,a){i[t]=e[a]}),t.push(i)}),t}function zipAttachment(e,i){e=e?e.split(","):[];var t=new Zip,a=e[0]||!1;a?!function(){var e=a[a.length-1],n=Math.round(1e6*Math.random()),r=_path2["default"].join(__dirname,"../tmp/"+n+".zip");"\\"===e||"/"===e?t.zipFolder(a,function(){return t.writeToFile(r,function(){i&&i(r)})}):i&&i(a)}():i&&i(null)}function sendMailing(e){_fs2["default"].readFile(e,"utf-8",function(e,i){var t=csv2json(i);t.forEach(function(e){e.to=replaceAll(e.to," ","").split(","),zipAttachment(e.attachments,function(i){var t=i?[i]:void 0;new _mailClass2["default"](_configJson2["default"].email.user,e.to,e.message,e.subject,t).send(_smtp2["default"])})})})}var _fs=require("fs"),_fs2=_interopRequireDefault(_fs),_path=require("path"),_path2=_interopRequireDefault(_path),_mailClass=require("./mail.class"),_mailClass2=_interopRequireDefault(_mailClass),_configJson=require("../config.json"),_configJson2=_interopRequireDefault(_configJson),_smtp=require("./smtp"),_smtp2=_interopRequireDefault(_smtp),_easyZip=require("easy-zip"),_easyZip2=_interopRequireDefault(_easyZip),Zip=_easyZip2["default"].EasyZip,base_dir=_path2["default"].resolve(_configJson2["default"].files.base),folders=_fs2["default"].readdirSync(base_dir);folders.forEach(function(e){var i=_path2["default"].join(base_dir,e+"/mailing.csv");sendMailing(i)});